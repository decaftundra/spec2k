<?php

namespace App\Console\Commands;

use App\Notification;
use App\NotificationPiecePart;
use App\SAPOAuth2Client;
use App\SAPAccessToken;
use Illuminate\Console\Command;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;

class FetchAndUpdateNotifications extends Command
{
    /**
     * Hide this command in the php artisan list.
     *
     * @var bool
     */
    protected $hidden = true;
    
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'spec2kapp:fetch_and_update_notifications';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Loops through a set of notifications and fetches the latest data from the SAP middleware.';
    
    /**
     * Notification IDs.
     *
     * @var array
     */
    protected $notificationIds = [
        '000350432485',
        '000350434329',
        '000350434958',
        '000350446111',
        '000350446751',
        '000350449906',
        '000350449909',
        '000350450019',
        '000350450051',
        '000350450697',
        '000350450910',
        '000350451981',
        '000350452460',
        '000350453496',
        '000350456181',
        '000350457601',
        '000350458036',
        '000350458697',
        '000350458898',
        '000350459672',
        '000350462189',
        '000350462444',
        '000350462569',
        '000350462750',
        '000350462754',
        '000350463185',
        '000350463987',
        '000350465764',
        '000350465934',
        '000350465954',
        '000350466328',
        '000350466525',
        '000350466539',
        '000350466840',
        '000350467111',
        '000350467113',
        '000350467283',
        '000350467317',
        '000350467608',
        '000350468184',
        '000350468290',
        '000350469625',
        '000350469701',
        '000350469889',
        '000350470249',
        '000350471557',
        '000350471580',
        '000350472035',
        '000350472185',
        '000350472603',
        '000350472634',
        '000350472757',
        '000350472770',
        '000350472825',
        '000350472881',
        '000350472884',
        '000350472920',
        '000350472956',
        '000350472957',
        '000350472959',
        '000350473020',
        '000350473023',
        '000350473484',
        '000350473576',
        '000350473648',
        '000350473652',
        '000350474887',
        '000350475019',
        '000350475471',
        '000350475629',
        '000350475647',
        '000350475648',
        '000350475651',
        '000350475653',
        '000350475738',
        '000350475897',
        '000350476076',
        '000350476313',
        '000350476318',
        '000350476464',
        '000350476478',
        '000350476496',
        '000350476721',
        '000350476969',
        '000350477015',
        '000350477021',
        '000350477297',
        '000350477623',
        '000350477662',
        '000350477881',
        '000350477966',
        '000350478230',
        '000350478313',
        '000350478699',
        '000350478842',
        '000350478913',
        '000350478919',
        '000350478927',
        '000350478936',
        '000350478990',
        '000350479045',
        '000350479046',
        '000350479317',
        '000350479467',
        '000350479992',
        '000350480404',
        '000350480438',
        '000350480728',
        '000350480780',
        '000350480879',
        '000350480909',
        '000350480967',
        '000350481091',
        '000350481099',
        '000350481111',
        '000350481114',
        '000350481181',
        '000350481230',
        '000350481232',
        '000350481295',
        '000350481296',
        '000350481344',
        '000350481345',
        '000350481348',
        '000350481349',
        '000350481350',
        '000350481352',
        '000350481416',
        '000350481531',
        '000350481532',
        '000350481535',
        '000350481538',
        '000350481566',
        '000350481572',
        '000350481573',
        '000350481574',
        '000350481575',
        '000350481580',
        '000350481582',
        '000350481601',
        '000350481605',
        '000350481613',
        '000350481614',
        '000350481625',
        '000350481645',
        '000350481683',
        '000350482155',
        '000350482185',
        '000350482207',
        '000350482250',
        '000350482275',
        '000350482384',
        '000350482403',
        '000350482485',
        '000350482549',
        '000350482614',
        '000350482636',
        '000350482638',
        '000350482696',
        '000350482786',
        '000350482909',
        '000350483074',
        '000350483075',
        '000350483076',
        '000350483077',
        '000350483133',
        '000350483222',
        '000350483232',
        '000350483256',
        '000350483304',
        '000350483527',
        '000350483777',
        '000350483908',
        '000350484003',
        '000350484034',
        '000350484149',
        '000350484365',
        '000350484396',
        '000350484449',
        '000350484543',
        '000350484666',
        '000350484667',
        '000350484668',
        '000350484690',
        '000350484720',
        '000350484774',
        '000350485201',
        '000350485246',
        '000350485303',
        '000350485346',
        '000350485379',
        '000350485421',
        '000350485422',
        '000350485549',
        '000350485604',
        '000350485608',
        '000350485627',
        '000350485694',
        '000350485715',
        '000350485732',
        '000350485741',
        '000350485742',
        '000350485743',
        '000350485749',
        '000350485812',
        '000350485816',
        '000350485828',
        '000350485829',
        '000350485935',
        '000350485949',
        '000350485950',
        '000350485951',
        '000350485963',
        '000350485989',
        '000350485996',
        '000350486007',
        '000350486015',
        '000350486016',
        '000350486021',
        '000350486055',
        '000350486075',
        '000350486076',
        '000350486077',
        '000350486086',
        '000350486110',
        '000350486152',
        '000350486216',
        '000350486239',
        '000350486240',
        '000350486337',
        '000350486339',
        '000350486345',
        '000350486347',
        '000350486401',
        '000350486454',
        '000350486457',
        '000350486463',
        '000350486493',
        '000350486504',
        '000350486519',
        '000350486538',
        '000350486539',
        '000350486545',
        '000350486566',
        '000350486591',
        '000350486618',
        '000350486629',
        '000350486634',
        '000350486640',
        '000350486647',
        '000350486683',
        '000350486684',
        '000350486685',
        '000350486698',
        '000350486783',
        '000350486793',
        '000350486815',
        '000350486819',
        '000350486935',
        '000350486946',
        '000350486961',
        '000350486981',
        '000350487148',
        '000350487203',
        '000350487218',
        '000350487221',
        '000350487261',
        '000350487279',
        '000350487305',
        '000350487311',
        '000350487320',
        '000350487321',
        '000350487341',
        '000350487461',
        '000350487462',
        '000350487466',
        '000350487472',
        '000350487503',
        '000350487581',
        '000350487582',
        '000350487593',
        '000350487622',
        '000350487630',
        '000350487702',
        '000350487719',
        '000350487816',
        '000350487820',
        '000350487892',
        '000350487893',
        '000350487944',
        '000350487984',
        '000350488021',
        '000350488023',
        '000350488029',
        '000350488052',
        '000350488070',
        '000350488075',
        '000350488087',
        '000350488096',
        '000350488116',
        '000350488169',
        '000350488191',
        '000350488227',
        '000350488530',
        '000350488537',
        '000350488576',
        '000350488605',
        '000350488624',
        '000350488639',
        '000350488672',
        '000350488673',
        '000350488756',
        '000350488792',
        '000350488793',
        '000350488795',
        '000350488796',
        '000350488859',
        '000350488864',
        '000350488882',
        '000350488889',
        '000350488934',
        '000350488937',
        '000350488949',
        '000350488951',
        '000350488970',
        '000350488989',
        '000350489196',
        '000350489202',
        '000350489208',
        '000350489230',
        '000350489232',
        '000350489296',
        '000350489297',
        '000350489311',
        '000350489362',
        '000350489440',
        '000350489464',
        '000350489484',
        '000350489588',
        '000350489592',
        '000350489594',
        '000350489607',
        '000350489622',
        '000350489631',
        '000350489633',
        '000350489634',
        '000350489698',
        '000350489710',
        '000350489711',
        '000350489770',
        '000350489776',
        '000350489796',
        '000350489799',
        '000350489812',
        '000350489814',
        '000350489818',
        '000350489821',
        '000350489833',
        '000350489844',
        '000350489873',
        '000350489880',
        '000350489925',
        '000350489949',
        '000350489954',
        '000350489957',
        '000350489967',
        '000350489995',
        '000350490000',
        '000350490004',
        '000350490023',
        '000350490025',
        '000350490031',
        '000350490057',
        '000350490105',
        '000350490118',
        '000350490126',
        '000350490149',
        '000350490154',
        '000350490157',
        '000350490159',
        '000350490174',
        '000350490295',
        '000350490383',
        '000350490394',
        '000350490429',
        '000350490450',
        '000350490473',
        '000350490481',
        '000350490489',
        '000350490490',
        '000350490498',
        '000350490516',
        '000350490532',
        '000350490538',
        '000350490541',
        '000350490555',
        '000350490566',
        '000350490575',
        '000350490581',
        '000350490586',
        '000350490587',
        '000350490599',
        '000350490608',
        '000350490644',
        '000350490724',
        '000350490734',
        '000350490736',
        '000350490737',
        '000350490739',
        '000350490764',
        '000350490771',
        '000350490772',
        '000350490787',
        '000350490824',
        '000350490841',
        '000350490922',
        '000350490935',
        '000350490998',
        '000350491028',
        '000350491041',
        '000350491076',
        '000350491078',
        '000350491099',
        '000350491171',
        '000350491175',
        '000350491230',
        '000350491242',
        '000350491251',
        '000350491285',
        '000350491287',
        '000350491289',
        '000350491299',
        '000350491331',
        '000350491334',
        '000350491335',
        '000350491337',
        '000350491352',
        '000350491404',
        '000350491408',
        '000350491413',
        '000350491418',
        '000350491444',
        '000350491497',
        '000350491505',
        '000350491565',
        '000350491571',
        '000350491595',
        '000350491617',
        '000350491621',
        '000350491628',
        '000350491645',
        '000350491795',
        '000350491839',
        '000350491847',
        '000350491848',
        '000350491899',
        '000350491902',
        '000350491905',
        '000350491909',
        '000350491910',
        '000350491915',
        '000350491928',
        '000350491929',
        '000350491938',
        '000350491944',
        '000350491960',
        '000350491962',
        '000350491964',
        '000350491989',
        '000350491990',
        '000350491991',
        '000350492031',
        '000350492034',
        '000350492050',
        '000350492057',
        '000350492070',
        '000350492078',
        '000350492100',
        '000350492103',
        '000350492106',
        '000350492112',
        '000350492121',
        '000350492123',
        '000350492132',
        '000350492148',
        '000350492156',
        '000350492187',
        '000350492188',
        '000350492195',
        '000350492196',
        '000350492197',
        '000350492198',
        '000350492199',
        '000350492203',
        '000350492210',
        '000350492251',
        '000350492257',
        '000350492283',
        '000350492286',
        '000350492301',
        '000350492334',
        '000350492352',
        '000350492358',
        '000350492371',
        '000350492373',
        '000350492378',
        '000350492400',
        '000350492405',
        '000350492406',
        '000350492408',
        '000350492421',
        '000350492422',
        '000350492423',
        '000350492424',
        '000350492427',
        '000350492428',
        '000350492429',
        '000350492433',
        '000350492435',
        '000350492436',
        '000350492438',
        '000350492439',
        '000350492440',
        '000350492453',
        '000350492455',
        '000350492460',
        '000350492462',
        '000350492464',
        '000350492479',
        '000350492484',
        '000350492510',
        '000350492519',
        '000350492526',
        '000350492553',
        '000350492557',
        '000350492584',
        '000350492594',
        '000350492659',
        '000350492696',
        '000350492697',
        '000350492698',
        '000350492720',
        '000350492725',
        '000350492734',
        '000350492735',
        '000350492748',
        '000350492789',
        '000350492812',
        '000350492873',
        '000350492883',
        '000350492916',
        '000350492919',
        '000350492939',
        '000350493027',
        '000350493030',
        '000350493032',
        '000350493041',
        '000350493090',
        '000350493109',
        '000350493125',
        '000350493186',
        '000350493192',
        '000350493202',
        '000350493235',
        '000350493237',
        '000350493245',
        '000350493247',
        '000350493254',
        '000350493258',
        '000350493270',
        '000350493273',
        '000350493274',
        '000350493280',
        '000350493290',
        '000350493296',
        '000350493298',
        '000350493314',
        '000350493315',
        '000350493338',
        '000350493383',
        '000350493414',
        '000350493417',
        '000350493419',
        '000350493426',
        '000350493427',
        '000350493429',
        '000350493445',
        '000350493468',
        '000350493473',
        '000350493506',
        '000350493515',
        '000350493534',
        '000350493562',
        '000350493573',
        '000350493575',
        '000350493602',
        '000350493616',
        '000350493617',
        '000350493656',
        '000350493666',
        '000350493686',
        '000350493688',
        '000350493704',
        '000350493740',
        '000350493751',
        '000350493766',
        '000350493768',
        '000350493805',
        '000350493827',
        '000350493837',
        '000350493850',
        '000350493863',
        '000350493871',
        '000350493875',
        '000350493881',
        '000350493893',
        '000350493898',
        '000350493930',
        '000350493935',
        '000350493950',
        '000350493978',
        '000350494051',
        '000350494062',
        '000350494078',
        '000350494079',
        '000350494092',
        '000350494093',
        '000350494097',
        '000350494106',
        '000350494107',
        '000350494113',
        '000350494121',
        '000350494134',
        '000350494138',
        '000350494140',
        '000350494150',
        '000350494153',
        '000350494174',
        '000350494200',
        '000350494203',
        '000350494204',
        '000350494205',
        '000350494206',
        '000350494208',
        '000350494213',
        '000350494231',
        '000350494232',
        '000350494233',
        '000350494235',
        '000350494236',
        '000350494251',
        '000350494281',
        '000350494283',
        '000350494286',
        '000350494312',
        '000350494320',
        '000350494335',
        '000350494349',
        '000350494351',
        '000350494371',
        '000350494436',
        '000350494449',
        '000350494464',
        '000350494481',
        '000350494488',
        '000350494489',
        '000350494503',
        '000350494511',
        '000350494517',
        '000350494519',
        '000350494520',
        '000350494544',
        '000350494555',
        '000350494556',
        '000350494558',
        '000350494572',
        '000350494588',
        '000350494593',
        '000350494609',
        '000350494611',
        '000350494620',
        '000350494631',
        '000350494634',
        '000350494644',
        '000350494652',
        '000350494685',
        '000350494701',
        '000350494716',
        '000350494731',
        '000350494753',
        '000350494768',
        '000350494776',
        '000350494779',
        '000350494781',
        '000350494783',
        '000350494786',
        '000350494791',
        '000350494795',
        '000350494803',
        '000350494817',
        '000350494823',
        '000350494840',
        '000350494841',
        '000350494842',
        '000350494855',
        '000350494858',
        '000350494888',
        '000350494890',
        '000350494894',
        '000350494962',
        '000350494965',
        '000350494966',
        '000350494975',
        '000350494991',
        '000350494993',
        '000350494998',
        '000350495035',
        '000350495037',
        '000350495038',
        '000350495040',
        '000350495044',
        '000350495058',
        '000350495062',
        '000350495064',
        '000350495066',
        '000350495114',
        '000350495125',
        '000350495133',
        '000350495145',
        '000350495146',
        '000350495193',
        '000350495295',
        '000350495321',
        '000350495324',
        '000350495326',
        '000350495328',
        '000350495330',
        '000350495331',
        '000350495354',
        '000350495362',
        '000350495378',
        '000350495387',
        '000350495398',
        '000350495406',
        '000350495408',
        '000350495409',
        '000350495416',
        '000350495417',
        '000350495418',
        '000350495425',
        '000350495474',
        '000350495492',
        '000350495517',
        '000350495529',
        '000350495564',
        '000350495584',
        '000350495586',
        '000350495601',
        '000350495602',
        '000350495603',
        '000350495620',
        '000350495623',
        '000350495625',
        '000350495633',
        '000350495645',
        '000350495674',
        '000350495675',
        '000350495676',
        '000350495678',
        '000350495707',
        '000350495716',
        '000350495717',
        '000350495718',
        '000350495719',
        '000350495720',
        '000350495721',
        '000350495722',
        '000350495723',
        '000350495725',
        '000350495726',
        '000350495727',
        '000350495728',
        '000350495729',
        '000350495781',
        '000350495788',
        '000350495792',
        '000350495795',
        '000350495797',
        '000350495799',
        '000350495804',
        '000350495835',
        '000350495840',
        '000350495842',
        '000350495844',
        '000350495847',
        '000350495867',
        '000350495886',
        '000350495896',
        '000350495902',
        '000350495908',
        '000350495910',
        '000350495956',
        '000350495974',
        '000350496020',
        '000350496021',
        '000350496048',
        '000350496075',
        '000350496082',
        '000350496093',
        '000350496141',
        '000350496144',
        '000350496145',
        '000350496148',
        '000350496151',
        '000350496152',
        '000350496154',
        '000350496155',
        '000350496156',
        '000350496163',
        '000350496169',
        '000350496170',
        '000350496171',
        '000350496205',
        '000350496228',
        '000350496229',
        '000350496253',
        '000350496256',
        '000350496259',
        '000350496265',
        '000350496270',
        '000350496278',
        '000350496280',
        '000350496285',
        '000350496286',
        '000350496295',
        '000350496299',
        '000350496305',
        '000350496310',
        '000350496336',
        '000350496346',
        '000350496375',
        '000350496397',
        '000350496402',
        '000350496415',
        '000350496424',
        '000350496429',
        '000350496433',
        '000350496435',
        '000350496438',
        '000350496447',
        '000350496455',
        '000350496472',
        '000350496473',
        '000350496488',
        '000350496489',
        '000350496496',
        '000350496525',
        '000350496526',
        '000350496529',
        '000350496551',
        '000350496564',
        '000350496565',
        '000350496566',
        '000350496573',
        '000350496574',
        '000350496575',
        '000350496578',
        '000350496597',
        '000350496600',
        '000350496601',
        '000350496611',
        '000350496613',
        '000350496624',
        '000350496625',
        '000350496626',
        '000350496627',
        '000350496628',
        '000350496629',
        '000350496634',
        '000350496638',
        '000350496640',
        '000350496641',
        '000350496642',
        '000350496643',
        '000350496644',
        '000350496645',
        '000350496665',
        '000350496666',
        '000350496667',
        '000350496670',
        '000350496671',
        '000350496703',
        '000350496714',
        '000350496716',
        '000350496719',
        '000350496730',
        '000350496754',
        '000350496762',
        '000350496763',
        '000350496772',
        '000350496782',
        '000350496785',
        '000350496793',
        '000350496794',
        '000350496795',
        '000350496796',
        '000350496797',
        '000350496798',
        '000350496799',
        '000350496806',
        '000350496822',
        '000350496823',
        '000350496824',
        '000350496834',
        '000350496840',
        '000350496841',
        '000350496842',
        '000350496843',
        '000350496853',
        '000350496854',
        '000350496865',
        '000350496882',
        '000350496884',
        '000350496889',
        '000350496893',
        '000350496951',
        '000350496952',
        '000350496956',
        '000350496965',
        '000350496969',
        '000350496971',
        '000350496992',
        '000350497000',
        '000350497028',
        '000350497034',
        '000350497037',
        '000350497047',
        '000350497048',
        '000350497051',
        '000350497053',
        '000350497058',
        '000350497061',
        '000350497064',
        '000350497087',
        '000350497103',
        '000350497109',
        '000350497132',
        '000350497137',
        '000350497155',
        '000350497158',
        '000350497186',
        '000350497221',
        '000350497223',
        '000350497225',
        '000350497232',
        '000350497240',
        '000350497246',
        '000350497259',
        '000350497261',
        '000350497265',
        '000350497270',
        '000350497291',
        '000350497305',
        '000350497312',
        '000350497313',
        '000350497314',
        '000350497322',
        '000350497329',
        '000350497331',
        '000350497332',
        '000350497335',
        '000350497337',
        '000350497338',
        '000350497352',
        '000350497392',
        '000350497395',
        '000350497407',
        '000350497425',
        '000350497485',
        '000350497487',
        '000350497493',
        '000350497499',
        '000350497505',
        '000350497506',
        '000350497508',
        '000350497513',
        '000350497528',
        '000350497529',
        '000350497533',
        '000350497535',
        '000350497538',
        '000350497540',
        '000350497541',
        '000350497546',
        '000350497557',
        '000350497561',
        '000350497567',
        '000350497578',
        '000350497579',
        '000350497583',
        '000350497585',
        '000350497589',
        '000350497610',
        '000350497615',
        '000350497618',
        '000350497636',
        '000350497663',
        '000350497664',
        '000350497671',
        '000350497672',
        '000350497678',
        '000350497690',
        '000350497692',
        '000350497693',
        '000350497694',
        '000350497701',
        '000350497706',
        '000350497708',
        '000350497709',
        '000350497763',
        '000350497764',
        '000350497766',
        '000350497770',
        '000350497775',
        '000350497777',
        '000350497788',
        '000350497794',
        '000350497813',
        '000350497816',
        '000350497863',
        '000350497884',
        '000350497887',
        '000350497917',
        '000350497918',
        '000350497924',
        '000350497929',
        '000350497931',
        '000350497932',
        '000350497944',
        '000350497946',
        '000350497950',
        '000350497952',
        '000350497955',
        '000350497967',
        '000350497973',
        '000350497981',
        '000350497982',
        '000350497987',
        '000350497988',
        '000350497993',
        '000350497997',
        '000350498004',
        '000350498008',
        '000350498012',
        '000350498013',
        '000350498017',
        '000350498018',
        '000350498037',
        '000350498057',
        '000350498059',
        '000350498065',
        '000350498085',
        '000350498087',
        '000350498095',
        '000350498101',
        '000350498116',
        '000350498132',
        '000350498133',
        '000350498141',
        '000350498146',
        '000350498147',
        '000350498148',
        '000350498156',
        '000350498165',
        '000350498187',
        '000350498196',
        '000350498199',
        '000350498212',
        '000350498214',
        '000350498215',
        '000350498222',
        '000350498225',
        '000350498226',
        '000350498228',
        '000350498240',
        '000350498241',
        '000350498242',
        '000350498274',
        '000350498278',
        '000350498290',
        '000350498291',
        '000350498293',
        '000350498313',
        '000350498334',
        '000350498335',
        '000350498359',
        '000350498431',
        '000350498437',
        '000350498438',
        '000350498463',
        '000350498468',
        '000350498487',
        '000350498493',
        '000350498508',
        '000350498518',
        '000350498525',
        '000350498526',
        '000350498527',
        '000350498534',
        '000350498535',
        '000350498536',
        '000350498539',
        '000350498543',
        '000350498544',
        '000350498545',
        '000350498547',
        '000350498552',
        '000350498555',
        '000350498557',
        '000350498577',
        '000350498584',
        '000350498597',
        '000350498604',
        '000350498618',
        '000350498619',
        '000350498621',
        '000350498653',
        '000350498658',
        '000350498674',
        '000350498676',
        '000350498677',
        '000350498680',
        '000350498682',
        '000350498683',
        '000350498685',
        '000350498688',
        '000350498691',
        '000350498693',
        '000350498698',
        '000350498700',
        '000350498703',
        '000350498704',
        '000350498710',
        '000350498714',
        '000350498719',
        '000350498734',
        '000350498737',
        '000350498756',
        '000350498757',
        '000350498788',
        '000350498795',
        '000350498796',
        '000350498798',
        '000350498799',
        '000350498823',
        '000350498824',
        '000350498830',
        '000350498841',
        '000350498846',
        '000350498894',
        '000350498917',
        '000350498918',
        '000350498939',
        '000350498952',
        '000350498956',
        '000350498976',
        '000350498995',
        '000350499002',
        '000350499003',
        '000350499008',
        '000350499011',
        '000350499013',
        '000350499017',
        '000350499018',
        '000350499022',
        '000350499057',
        '000350499060',
        '000350499065',
        '000350499066',
        '000350499080',
        '000350499101',
        '000350499117',
        '000350499130',
        '000350499149',
        '000350499167',
        '000350499168',
        '000350499172',
        '000350499177',
        '000350499178',
        '000350499179',
        '000350499199',
        '000350499213',
        '000350499214',
        '000350499221',
        '000350499228',
        '000350499232',
        '000350499249',
        '000350499254',
        '000350499255',
        '000350499258',
        '000350499259',
        '000350499269',
        '000350499282',
        '000350499284',
        '000350499286',
        '000350499291',
        '000350499297',
        '000350499308',
        '000350499309',
        '000350499311',
        '000350499315',
        '000350499321',
        '000350499322',
        '000350499323',
        '000350499324',
        '000350499333',
        '000350499344',
        '000350499347',
        '000350499348',
        '000350499349',
        '000350499363',
        '000350499365',
        '000350499366',
        '000350499377',
        '000350499378',
        '000350499380',
        '000350499404',
        '000350499405',
        '000350499408',
        '000350499411',
        '000350499417',
        '000350499422',
        '000350499440',
        '000350499443',
        '000350499444',
        '000350499452',
        '000350499459',
        '000350499468',
        '000350499476',
        '000350499479',
        '000350499491',
        '000350499499',
        '000350499508',
        '000350499517',
        '000350499518',
        '000350499520',
        '000350499524',
        '000350499525',
        '000350499526',
        '000350499528',
        '000350499533',
        '000350499537',
        '000350499547',
        '000350499561',
        '000350499566',
        '000350499569',
        '000350499570',
        '000350499572',
        '000350499578',
        '000350499585',
        '000350499610',
        '000350499620',
        '000350499637',
        '000350499642',
        '000350499645',
        '000350499646',
        '000350499650',
        '000350499675',
        '000350499678',
        '000350499711',
        '000350499712',
        '000350499713',
        '000350499715',
        '000350499717',
        '000350499718',
        '000350499719',
        '000350499740',
        '000350499743',
        '000350499744',
        '000350499754',
        '000350499758',
        '000350499759',
        '000350499771',
        '000350499775',
        '000350499778',
        '000350499788',
        '000350499790',
        '000350499794',
        '000350499801',
        '000350499808',
        '000350499810',
        '000350499813',
        '000350499835',
        '000350499844',
        '000350499846',
        '000350499848',
        '000350499851',
        '000350499856',
        '000350499860',
        '000350499861',
        '000350499862',
        '000350499868',
        '000350499873',
        '000350499875',
        '000350499880',
        '000350499889',
        '000350499891',
        '000350499901',
        '000350499911',
        '000350499912',
        '000350499914',
        '000350499917',
        '000350499930',
        '000350499960',
        '000350499962',
        '000350499963',
        '000350499967',
        '000350499968',
        '000350499999',
        '000350500004',
        '000350500005',
        '000350500006',
        '000350500007',
        '000350500010',
        '000350500011',
        '000350500012',
        '000350500014',
        '000350500019',
        '000350500024',
        '000350500025',
        '000350500026',
        '000350500027',
        '000350500028',
        '000350500036',
        '000350500046',
        '000350500054',
        '000350500060',
        '000350500062',
        '000350500063',
        '000350500077',
        '000350500088',
        '000350500093',
        '000350500103',
        '000350500116',
        '000350500125',
        '000350500134',
        '000350500144',
        '000350500153',
        '000350500155',
        '000350500157',
        '000350500161',
        '000350500163',
        '000350500164',
        '000350500169',
        '000350500171',
        '000350500172',
        '000350500197',
        '000350500203',
        '000350500210',
        '000350500216',
        '000350500217',
        '000350500218',
        '000350500256',
        '000350500257',
        '000350500258',
        '000350500272',
        '000350500275',
        '000350500324',
        '000350500335',
        '000350500336',
        '000350500338',
        '000350500340',
        '000350500350',
        '000350500353',
        '000350500357',
        '000350500371',
        '000350500375',
        '000350500377',
        '000350500378',
        '000350500379',
        '000350500397',
        '000350500399',
        '000350500404',
        '000350500407',
        '000350500410',
        '000350500412',
        '000350500420',
        '000350500435',
        '000350500437',
        '000350500438',
        '000350500440',
        '000350500454',
        '000350500488',
        '000350500505',
        '000350500517',
        '000350500529',
        '000350500534',
        '000350500535',
        '000350500540',
        '000350500561',
        '000350500576',
        '000350500580',
        '000350500581',
        '000350500584',
        '000350500590',
        '000350500591',
        '000350500592',
        '000350500594',
        '000350500600',
        '000350500603',
        '000350500604',
        '000350500605',
        '000350500608',
        '000350500610',
        '000350500611',
        '000350500615',
        '000350500634',
        '000350500638',
        '000350500650',
        '000350500652',
        '000350500657',
        '000350500658',
        '000350500659',
        '000350500664',
        '000350500665',
        '000350500667',
        '000350500669',
        '000350500671',
        '000350500687',
        '000350500689',
        '000350500691',
        '000350500714',
        '000350500715',
        '000350500724',
        '000350500733',
        '000350500736',
        '000350500746',
        '000350500747',
        '000350500748',
        '000350500754',
        '000350500756',
        '000350500759',
        '000350500763',
        '000350500764',
        '000350500765',
        '000350500766',
        '000350500773',
        '000350500775',
        '000350500776',
        '000350500777',
        '000350500778',
        '000350500779',
        '000350500801',
        '000350500802',
        '000350500805',
        '000350500808',
        '000350500815',
        '000350500820',
        '000350500821',
        '000350500823',
        '000350500826',
        '000350500836',
        '000350500840',
        '000350500843',
        '000350500844',
        '000350500845',
        '000350500858',
        '000350500868',
        '000350500869',
        '000350500883',
        '000350500889',
        '000350500892',
        '000350500901',
        '000350500905',
        '000350500909',
        '000350500911',
        '000350500922',
        '000350500925',
        '000350500941',
        '000350500942',
        '000350500944',
        '000350500945',
        '000350500958',
        '000350500982',
        '000350500993',
        '000350501033',
        '000350501036',
        '000350501039',
        '000350501053',
        '000350501059',
        '000350501062',
        '000350501064',
        '000350501067',
        '000350501070',
        '000350501087',
        '000350501102',
        '000350501110',
        '000350501112',
        '000350501115',
        '000350501123',
        '000350501125',
        '000350501129',
        '000350501138',
        '000350501141',
        '000350501142',
        '000350501151',
        '000350501152',
        '000350501154',
        '000350501155',
        '000350501161',
        '000350501163',
        '000350501173',
        '000350501181',
        '000350501203',
        '000350501212',
        '000350501227',
        '000350501238',
        '000350501240',
        '000350501303',
        '000350501314',
        '000350501316',
        '000350501317',
        '000350501318',
        '000350501319',
        '000350501321',
        '000350501322',
        '000350501330',
        '000350501337',
        '000350501340',
        '000350501341',
        '000350501343',
        '000350501345',
        '000350501346',
        '000350501347',
        '000350501348',
        '000350501351',
        '000350501353',
        '000350501372',
        '000350501373',
        '000350501395',
        '000350501397',
        '000350501449',
        '000350501459',
        '000350501502',
        '000350501542',
        '000350501543',
        '000350501545',
        '000350501551',
        '000350501566',
        '000350501606',
        '000350501630',
        '000350501643',
        '000350501645',
        '000350501649',
        '000350501650',
        '000350501674',
        '000350501680',
        '000350501726',
        '000350501727',
        '000350501728',
        '000350501729',
        '000350501742',
        '000350501744',
        '000350501749',
        '000350501751',
        '000350501753',
        '000350501761',
        '000350501776',
        '000350501780',
        '000350501781',
        '000350501782',
        '000350501811',
        '000350501813',
        '000350501840',
        '000350501842',
        '000350501843',
        '000350501846',
        '000350501859',
        '000350501862',
        '000350501869',
        '000350501882',
        '000350501892',
        '000350501906',
        '000350501909',
        '000350501910',
        '000350501917',
        '000350501919',
        '000350501930',
        '000350501934',
        '000350501937',
        '000350501938',
        '000350501940',
        '000350501943',
        '000350501944',
        '000350501949',
        '000350501956',
        '000350501957',
        '000350501958',
        '000350501961',
        '000350501963',
        '000350501967',
        '000350501970',
        '000350501974',
        '000350501977',
        '000350501980',
        '000350501999',
        '000350502000',
        '000350502001',
        '000350502003',
        '000350502005',
        '000350502023',
        '000350502032',
        '000350502033',
        '000350502057',
        '000350502060',
        '000350502062',
        '000350502114',
        '000350502115',
        '000350502117',
        '000350502119',
        '000350502121',
        '000350502122',
        '000350502130',
        '000350502134',
        '000350502139',
        '000350502152',
        '000350502218',
        '000350502237',
        '000350502348',
        '000350502357',
        '000350502371',
        '000350502372',
        '000350502375',
        '000350502379',
        '000350502385',
        '000350502391',
        '000350502393',
        '000350502403',
        '000350502413',
        '000350502436',
        '000350502443',
        '000350502450',
        '000350502453',
        '000350502455',
        '000350502458',
        '000350502459',
        '000350502469',
        '000350502471',
        '000350502481',
        '000350502484',
        '000350502487',
        '000350502489',
        '000350502500',
        '000350502529',
        '000350502562',
        '000350502563',
        '000350502594',
        '000350502595',
        '000350502597',
        '000350502621',
        '000350502623',
        '000350502625',
        '000350502644',
        '000350502649',
        '000350502681',
        '000350502683',
        '000350502684',
        '000350502685',
        '000350502687',
        '000350502688',
        '000350502689',
        '000350502700',
        '000350502701',
        '000350502702',
        '000350502728',
        '000350502758',
        '000350502802',
        '000350502804',
        '000350502809',
        '000350502849',
        '000350502861',
        '000350502881',
        '000350502887',
        '000350502889',
        '000350502905',
        '000350502998',
        '000350503000',
        '000350503042',
        '000350503043',
        '000350503049',
        '000350503089',
        '000350503125',
        '000350503127',
        '000350503150',
        '000350503258',
        '000350503402',
        '000350503499',
        '000350503514',
        '000350503516',
        '000350451932',
        '000350456353',
        '000350468208',
        '000350469880',
        '000350469882',
        '000350475996',
        '000350478042',
        '000350482896',
        '000350485477',
        '000350486014',
        '000350486333',
        '000350486470',
        '000350487220',
        '000350488160',
        '000350488177',
        '000350488227',
        '000350488582',
        '000350489238',
        '000350489530',
        '000350489531',
        '000350490130',
        '000350490133',
        '000350490341',
        '000350490803',
        '000350491041',
        '000350491340',
        '000350491437',
        '000350491913',
        '000350492195',
        '000350492196',
        '000350492197',
        '000350492198',
        '000350492199',
        '000350492203',
        '000350492210',
        '000350492972',
        '000350493165',
        '000350493200',
        '000350493204',
        '000350494047',
        '000350494164',
        '000350494313',
        '000350494319',
        '000350494524',
        '000350494696',
        '000350494710',
        '000350494911',
        '000350494975',
        '000350495007',
        '000350495551',
        '000350495599',
        '000350495645',
        '000350495676',
        '000350495859',
        '000350495956',
        '000350496407',
        '000350496451',
        '000350497462',
        '000350497589',
        '000350497707',
        '000350497713',
        '000350497723',
        '000350497960',
        '000350498099',
        '000350498114',
        '000350498420',
        '000350498465',
        '000350498493',
        '000350498628',
        '000350498781',
        '000350498896',
        '000350498962',
        '000350499164',
        '000350499170',
        '000350499305',
        '000350499611',
        '000350499741',
        '000350499757',
        '000350499808',
        '000350499810',
        '000350499851',
        '000350499900',
        '000350499961',
        '000350500010',
        '000350500046',
        '000350500216',
        '000350500233',
        '000350500292',
        '000350500368',
        '000350500393',
        '000350500397',
        '000350500399',
        '000350500413',
        '000350500608',
        '000350500610',
        '000350500638',
        '000350500646',
        '000350500710',
        '000350500802',
        '000350500804',
        '000350501067',
        '000350501069',
        '000350501234',
        '000350501348',
        '000350501454',
        '000350501455',
        '000350501571',
        '000350501727',
        '000350501735',
        '000350501897',
        '000350501909',
        '000350501910',
        '000350502051',
        '000350502099',
        '000350502121',
        '000350502123',
        '000350502469',
        '000350502482',
        '000350502483',
        '000350502595',
        '000350502629',
        '000350502777',
        '000350502781',
        '000350502804',
        '000350503040',
        '000350503041'
    ];

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return int
     */
    public function handle()
    {
        // Get the IDs of all notifications with a shop finding record, that are in our ids array and are still in_progress or subcontracted.
        $notificationIds = DB::table('notifications')
            ->select('notifications.*')
            ->leftJoin('shop_findings', 'notifications.id', '=', 'shop_findings.id')
            ->whereIn('notifications.status', ['in_progress', 'subcontracted'])
            ->whereNotNull('shop_findings.id')
            ->whereIn('notifications.id', $this->notificationIds)
            ->pluck('notifications.id')
            ->toArray();
        
        if (\App::environment(['live'])) {
            // Get notifications to be updated.
            $notifications = Notification::whereIn('id', $notificationIds)
                ->get();
        } else {
            // Test.
            $notifications = Notification::inRandomOrder()
                ->whereIn('status', ['in_progress', 'subcontracted'])
                ->limit(30)
                ->get();
        }
        
        if (!count($notifications)) {
            //$this->info('No notifications found.');
            
            return Command::SUCCESS;
        }
        
        // Chunk and loop through.
        Notification::chunk(100, function ($notifications) {
            foreach ($notifications as $notification) {
        
                // Fetch data from middleware.
                $id = $notification->id;
            
                try {
                    
                    $client = new SAPOAuth2Client;
                    
                    $notificationEndpoint = env('API_NOTIFICATION_ENDPOINT');
            
                    $response = $client->apiGetRequest($notificationEndpoint, ['notification' => $id]);
                    
                    // If unauthenticated response, purge and reset token, then retry.
                    if ($response->status == 401) {
                        Log::info('Unauthenticated API Middleware response for Notification: ' . $id, [$response->content]);
                        
                        $token = SAPAccessToken::first();
                        
                        $token ? Log::info('Token Data:', [$token]) : Log::info('No Tokens Found!');
                        
                        Log::info('Resetting Token');
                        
                        $client->resetAccessToken();
                        
                        // Create new response.
                        $response = $client->apiGetRequest($notificationEndpoint, ['notification' => $id]);
                    }
                    
                    if (($response->status == 200) && !empty($response->content->notification->id)) {
                        
                        Log::info('Successful API Middleware data retrieval for Notification: ' . $id, [$response->content]);
                        
                        // Store Notification and Notification Piece Part data in database...
                        Notification::updateFromMiddleware($response->content->notification);
                        
                        if (!empty($response->content->notification->piece_parts->item)) {
                            
                            if (!is_array($response->content->notification->piece_parts->item)) {
                                NotificationPiecePart::updateOrCreateFromMiddleware([$response->content->notification->piece_parts->item]);
                            } else {
                                NotificationPiecePart::updateOrCreateFromMiddleware($response->content->notification->piece_parts->item);
                            }
                        }
                        
                        //$this->info('Successful API Middleware data retrieval & update for Notification: ' . $id);
                        
                    } else if ($response->status != 404) {
                        Log::info('Error fetching notification data from SAP middleware. Notification ID: ' . $id);
                        
                        //$this->error('Error fetching notification data from SAP middleware. Notification ID: ' . $id);
                        
                        $token = SAPAccessToken::first();
                        
                        if ($token) {
                            Log::info('Token Data:', [$token]);
                        } else {
                            Log::info('No Tokens Found!');
                        }
                        
                        $client->resetAccessToken();
                        
                        $message = 'Error fetching notification data from SAP middleware. Notification ID: ' . $id . "\n";
                        $message .= json_encode($response);
                        throw new MiddlewareException($message);
                    }
                    
                } catch (MiddlewareException $e) {
                    Log::error($e->getMessage());
                }
                
                // Pause.
                //sleep(1);
            }
        });
        
        return Command::SUCCESS;
    }
}
